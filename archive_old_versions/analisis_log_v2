import pandas as pd
import numpy as np

# Cargar los datos
trades = pd.read_csv("trades_log.csv")
equity = pd.read_csv("equity_curve.csv")

# Filtrar solo operaciones cerradas (ventas)
closed_trades = trades[trades['type'] == 'sell'].copy()
buy_trades = trades[trades['type'] == 'buy'].copy()

# EstadÃ­sticas bÃ¡sicas
num_trades = len(buy_trades)
num_wins = (closed_trades['equity'].diff() > 0).sum()
num_losses = (closed_trades['equity'].diff() < 0).sum()

# Rendimiento
initial_equity = equity['equity'].iloc[0]
final_equity = equity['equity'].iloc[-1]
total_return = (final_equity - initial_equity) / initial_equity * 100

# Drawdown mÃ¡ximo
equity_series = equity['equity']
rolling_max = equity_series.cummax()
drawdown = (equity_series - rolling_max) / rolling_max
max_drawdown = drawdown.min() * 100

# Ratio de ganancias/pÃ©rdidas
win_rate = num_wins / (num_wins + num_losses) * 100 if (num_wins + num_losses) > 0 else 0

# Profit Factor (ganancias totales / pÃ©rdidas totales)
profits = closed_trades['equity'].diff()
profit_factor = profits[profits > 0].sum() / abs(profits[profits < 0].sum()) if profits[profits < 0].sum() != 0 else np.nan

# Sharpe Ratio (simplificado con retornos diarios)
returns = equity['equity'].pct_change().dropna()
sharpe_ratio = (returns.mean() / returns.std()) * np.sqrt(252) if returns.std() != 0 else np.nan

# Mostrar resultados
print("ðŸ“Š EstadÃ­sticas del Backtest")
print(f"NÃºmero de trades: {num_trades}")
print(f"Ganadores: {num_wins}, Perdedoras: {num_losses}")
print(f"Win Rate: {win_rate:.2f}%")
print(f"Equity inicial: {initial_equity:.2f}, Final: {final_equity:.2f}")
print(f"Retorno total: {total_return:.2f}%")
print(f"MÃ¡ximo Drawdown: {max_drawdown:.2f}%")
print(f"Profit Factor: {profit_factor:.2f}")
print(f"Sharpe Ratio: {sharpe_ratio:.2f}")
